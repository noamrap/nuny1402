<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Together - Mobile Fixed</title>
    <style>
        /* ×ª×™×§×•×Ÿ ×§×¨×™×˜×™ ×œ××•×‘×™×™×œ - ××•× ×¢ ×’×œ×™×œ×” ×•×§×¤×™×¦×•×ª */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ××•× ×¢ ×’×œ×™×œ×” */
            background-color: #2c3e50;
            font-family: 'Segoe UI', sans-serif;
            touch-action: none; /* ××•× ×¢ ×–×•× ×•×’×œ×™×œ×” ×‘×“×¤×“×¤×Ÿ */
            position: fixed; /* × ×•×¢×œ ××ª ×”××¡×š ×‘××™×™×¤×•×Ÿ */
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* ×××©×§ */
        #ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* ×××¤×©×¨ ×œ×’×¢×ª ×“×¨×š ×”-UI */
            z-index: 10;
        }

        .hud-top {
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            font-weight: bold;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
        }

        /* ×‘×¨ ×—×™×™× */
        .health-container {
            width: 120px;
            height: 15px;
            background: rgba(0,0,0,0.6);
            border: 1px solid white;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .health-bar {
            width: 100%; height: 100%;
            background: #ff4b1f;
            transition: width 0.2s;
        }

        /* ×§×• ×”×¤×¨×“×” ×œ××•×‘×™×™×œ */
        .divider {
            position: absolute;
            top: 0; left: 50%;
            width: 2px; height: 100%;
            background: rgba(255,255,255,0.1);
            transform: translateX(-50%);
        }

        /* ××¡×›×™× */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 20;
            pointer-events: auto; /* ×›××Ÿ ×›×Ÿ ×¦×¨×™×š ××’×¢ ×œ×›×¤×ª×•×¨×™× */
            text-align: center;
        }

        button {
            background: #00b894;
            border: none;
            padding: 20px 60px;
            color: white;
            font-size: 24px;
            border-radius: 50px;
            margin-top: 30px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        button:active { transform: scale(0.95); opacity: 0.8; }
        .hidden { display: none !important; }

        .tutorial {
            margin-top: 20px;
            display: flex;
            width: 100%;
            opacity: 0.8;
        }
        .tut-side { width: 50%; padding: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="hud-top">
            <div class="health-container">
                <div class="health-bar" id="healthBar"></div>
            </div>
            <div>ğŸ›¡ï¸ <span id="shieldCount">0</span></div>
            <div>â¤ï¸ <span id="score">0</span></div>
        </div>
        <div class="divider"></div>
        <div style="position: absolute; bottom: 0; left: 0; height: 5px; background: #00cec9; width: 0%; transition: width 0.5s;" id="progressBar"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="startScreen" class="overlay">
        <h1>×”×˜×™×¤×•×¡ ×œ×¤×¡×’×”</h1>
        <p>××¦×‘ ××•×‘×™×™×œ ××ª×•×§×Ÿ</p>
        <div class="tutorial">
            <div class="tut-side" style="border-left: 1px solid white;">ğŸ‘ˆ ×’×¢ ×›××Ÿ<br>×œ×©×œ×™×˜×” ×‘×©×××œ×™</div>
            <div class="tut-side">×’×¢ ×›××Ÿ ğŸ‘‰<br>×œ×©×œ×™×˜×” ×‘×™×× ×™</div>
        </div>
        <button onclick="startGame()">×©×—×§×•!</button>
    </div>

    <div id="loseScreen" class="overlay hidden">
        <h1 style="color: #ff7675;">× ×¤×¡×œ×ª×!</h1>
        <p id="deathReason">...</p>
        <button style="background: #d63031;" onclick="startGame()">× ×¡×• ×©×•×‘</button>
    </div>

    <div id="winScreen" class="overlay hidden">
        <h1 style="color: #ffeaa7; font-size: 40px;">×”×¦×œ×—×ª×! â¤ï¸</h1>
        <p id="finalScore"></p>
        <button onclick="startGame()">×¡×™×‘×•×‘ × ×•×¡×£</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ×ª××•× ×•×ª
        const imgP1 = new Image(); imgP1.src = "Screenshot_14.png"; 
        const imgP2 = new Image(); imgP2.src = "Screenshot_15.png";

        let width, height;
        let gameActive = false;
        let frames = 0;
        let animationFrameId;

        // ×”×’×“×¨×•×ª ××©×—×§
        const GOAL = 3000;
        let progress = 0;
        let score = 0;
        let health = 100;
        let difficulty = 1;

        // ×§×œ×˜ (Input)
        // ×‘××§×•× ×œ×©××•×¨ ××™×§×•× ××¦×‘×¢ ×‘×•×“×“, × ×—×©×‘ ×›×œ ×¤×¨×™×™× ××™×¤×” ×”××¦×‘×¢×•×ª
        let touchP1 = null; // ××™×§×•× X ×©×œ ××¦×‘×¢ ×¦×“ ×©×××œ
        let touchP2 = null; // ××™×§×•× X ×©×œ ××¦×‘×¢ ×¦×“ ×™××™×Ÿ
        let keys = {}; // ×œ××—×©×‘

        // ×™×©×•×™×•×ª
        let p1, p2;
        let entities = [];
        let particles = [];

        // --- ×”×ª×××ª ××¡×š ---
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- ××¢×¨×›×ª ××’×¢ (×”×œ×‘ ×©×œ ×”×ª×™×§×•×Ÿ) ---
        // ×× ×• ××•×¡×™×¤×™× ××ª ×”××™×¨×•×¢×™× ×œ×§× ×‘×¡ ×¢×¦××• ×¢× passive: false ×›×“×™ ×œ×× ×•×¢ ×’×œ×™×œ×”
        canvas.addEventListener('touchstart', handleTouch, { passive: false });
        canvas.addEventListener('touchmove', handleTouch, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        
        // ×ª××™×›×” ×’× ×‘×¢×›×‘×¨ ×œ××—×©×‘
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function handleTouch(e) {
            if(!gameActive) return;
            e.preventDefault(); // ××‘×˜×œ ×’×œ×™×œ×”/×–×•× - ×§×¨×™×˜×™!
            
            // ××™×¤×•×¡ ×–×× ×™
            touchP1 = null;
            touchP2 = null;

            // ×¢×‘×•×¨ ×¢×œ ×›×œ ×”××¦×‘×¢×•×ª ×©××•× ×—×•×ª ×›×¨×’×¢ ×¢×œ ×”××¡×š
            for (let i = 0; i < e.touches.length; i++) {
                const t = e.touches[i];
                const x = t.clientX;
                
                // ×‘×“×™×§×” ×¤×©×•×˜×”: ×¦×“ ×™××™×Ÿ ××• ×©×××œ?
                if (x < width / 2) {
                    touchP1 = x; // ×¢×“×›×•×Ÿ ××™×§×•× ×™×¢×“ ×œ×©×—×§×Ÿ ×©×××œ
                } else {
                    touchP2 = x; // ×¢×“×›×•×Ÿ ××™×§×•× ×™×¢×“ ×œ×©×—×§×Ÿ ×™××™×Ÿ
                }
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            // ×§×¨×™××” ×—×•×–×¨×ª ×œ-handleTouch ×›×“×™ ×œ×¢×“×›×Ÿ ××™ × ×©××¨ ×¢×œ ×”××¡×š
            handleTouch(e);
        }

        // --- ××—×œ×§×•×ª ---
        class Player {
            constructor(side) {
                this.side = side; // 'left' or 'right'
                this.radius = width < 500 ? 25 : 35; // ×§×¦×ª ×™×•×ª×¨ ×§×˜×Ÿ ×‘××•×‘×™×™×œ
                this.x = side === 'left' ? width * 0.25 : width * 0.75;
                this.y = height - 150;
                this.vx = 0;
                this.hasShield = false;
                this.img = side === 'left' ? imgP1 : imgP2;
                this.color = side === 'left' ? '#0984e3' : '#d63031';
            }

            update() {
                // ×—×™×©×•×‘ ×™×¢×“ ×ª× ×•×¢×”
                let targetX = null;
                
                // ×‘×“×™×§×ª ××’×¢
                if (this.side === 'left' && touchP1 !== null) targetX = touchP1;
                if (this.side === 'right' && touchP2 !== null) targetX = touchP2;

                // ×‘×“×™×§×ª ××§×œ×“×ª (×’×™×‘×•×™ ×œ××—×©×‘)
                if (this.side === 'left') {
                    if (keys['KeyA']) this.vx -= 1;
                    if (keys['KeyD']) this.vx += 1;
                } else {
                    if (keys['ArrowLeft']) this.vx -= 1;
                    if (keys['ArrowRight']) this.vx += 1;
                }

                // ×ª× ×•×¢×” ×—×œ×§×” ×œ×¢×‘×¨ ×”××¦×‘×¢
                if (targetX !== null) {
                    const diff = targetX - this.x;
                    this.vx += diff * 0.1; // ×›×•×— ××©×™×›×” ×œ××¦×‘×¢
                }

                // ×¤×™×–×™×§×”
                this.vx *= 0.85; // ×—×™×›×•×š ×—×–×§ ×œ×©×œ×™×˜×” ××“×•×™×§×ª
                this.x += this.vx;

                // ×’×‘×•×œ×•×ª
                if (this.x < this.radius) { this.x = this.radius; this.vx = 0; }
                if (this.x > width - this.radius) { this.x = width - this.radius; this.vx = 0; }

                // ×’×‘×•×œ×•×ª ×’×–×¨×” (××•×¤×¦×™×•× ×œ×™ - ××•× ×¢ ×”×ª× ×’×©×•×ª ×‘×™× ×™×”×)
                if (this.side === 'left' && this.x > width/2 - this.radius) {
                    this.x = width/2 - this.radius; this.vx = 0;
                }
                if (this.side === 'right' && this.x < width/2 + this.radius) {
                    this.x = width/2 + this.radius; this.vx = 0;
                }

                // ×›×‘×™×“×” ×¨×›×” (×’×œ×™×œ×” ×œ××˜×”)
                if (this.y < height - 100) this.y += 2;
                
                // ×‘×“×™×§×ª × ×¤×™×œ×”
                if (this.y > height + this.radius) {
                    gameOver("× ×¤×™×œ×” ×œ×ª×”×•×!");
                }
            }

            draw() {
                if (this.hasShield) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius + 5, 0, Math.PI*2);
                    ctx.strokeStyle = '#00b894';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
                
                ctx.save();
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.clip();
                try {
                    ctx.drawImage(this.img, this.x - this.radius, this.y - this.radius, this.radius*2, this.radius*2);
                } catch(e) {
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                ctx.restore();
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#fff';
                ctx.stroke();
            }
        }

        class Entity {
            constructor() {
                this.type = Math.random() > 0.8 ? (Math.random() > 0.5 ? 'heart' : 'shield') : 'rock';
                this.x = Math.random() * (width - 40) + 20;
                this.y = -50;
                this.size = this.type === 'rock' ? 20 + Math.random() * 25 : 25;
                this.speed = (3 + Math.random() * 3) * difficulty;
                this.active = true;
            }

            update() {
                this.y += this.speed;
                if (this.y > height + 50) this.active = false;
            }

            draw() {
                ctx.font = "30px Arial";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                if (this.type === 'rock') {
                    ctx.fillStyle = '#636e72';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                    ctx.fill();
                    // ××¤×§×˜ ×¡×œ×¢ ×¤×©×•×˜
                    ctx.fillStyle = 'rgba(0,0,0,0.3)';
                    ctx.beginPath();
                    ctx.arc(this.x - 5, this.y - 5, this.size/2, 0, Math.PI*2);
                    ctx.fill();
                } else if (this.type === 'heart') {
                    ctx.fillText("â¤ï¸", this.x, this.y);
                } else if (this.type === 'shield') {
                    ctx.fillText("ğŸ›¡ï¸", this.x, this.y);
                }
            }
        }

        // --- ×œ×•×’×™×§×” ---
        function init() {
            p1 = new Player('left');
            p2 = new Player('right');
            entities = [];
            particles = [];
            score = 0;
            progress = 0;
            health = 100;
            difficulty = 1;
            frames = 0;
            
            document.getElementById('healthBar').style.width = '100%';
            document.getElementById('healthBar').style.background = '#ff4b1f';
        }

        function update() {
            if(!gameActive) return;
            frames++;
            progress += 1 * difficulty;
            
            // ×¢×“×›×•×Ÿ ×§×•×©×™
            difficulty = 1 + (progress / 2000);
            
            // UI
            document.getElementById('score').innerText = score;
            document.getElementById('shieldCount').innerText = (p1.hasShield?1:0) + (p2.hasShield?1:0);
            document.getElementById('progressBar').style.width = Math.min(100, (progress/GOAL)*100) + "%";

            // × ×™×¦×—×•×Ÿ
            if (progress >= GOAL) {
                winGame();
                return;
            }

            // ×™×¦×™×¨×ª ××•×™×‘×™×
            if (frames % Math.floor(40 / difficulty) === 0) {
                entities.push(new Entity());
            }

            p1.update();
            p2.update();

            // ××›× ×™×§×ª ×”×—×‘×œ
            const dx = p1.x - p2.x;
            const dy = p1.y - p2.y;
            // ×× ×¨×—×•×§×™× ××“×™, ××•×©×›×™× ××—×“ ××ª ×”×©× ×™
            if (Math.hypot(dx, dy) > width * 0.7) {
                p1.vx -= dx * 0.005;
                p2.vx += dx * 0.005;
            }

            // ×‘×“×™×§×ª ×”×ª× ×’×©×•×™×•×ª
            entities = entities.filter(e => e.active);
            entities.forEach(e => {
                e.update();
                [p1, p2].forEach(p => {
                    const dist = Math.hypot(p.x - e.x, p.y - e.y);
                    if (dist < p.radius + e.size) {
                        if (e.type === 'rock') {
                            if (p.hasShield) {
                                p.hasShield = false;
                                e.active = false;
                                createParticles(e.x, e.y, '#00b894');
                            } else {
                                health -= 25;
                                document.getElementById('healthBar').style.width = Math.max(0, health) + "%";
                                createParticles(p.x, p.y, '#d63031');
                                p.y += 100; // ××›×” ×œ××˜×”
                                e.active = false;
                                if (health <= 0) gameOver("× ×’××¨×” ×”×× ×¨×’×™×”!");
                            }
                        } else if (e.type === 'heart') {
                            score += 100;
                            health = Math.min(100, health + 15);
                            document.getElementById('healthBar').style.width = health + "%";
                            e.active = false;
                        } else if (e.type === 'shield') {
                            p.hasShield = true;
                            e.active = false;
                        }
                    }
                });
            });

            // ×—×œ×§×™×§×™×
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life--;
                if(p.life <= 0) particles.splice(i, 1);
            });
        }

        function createParticles(x, y, color) {
            for(let i=0; i<10; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                    life: 20, color: color
                });
            }
        }

        function draw() {
            // ×¨×§×¢
            const grad = ctx.createLinearGradient(0,0,0,height);
            grad.addColorStop(0, '#74b9ff');
            grad.addColorStop(1, '#dfe6e9');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,width,height);

            // ×—×‘×œ
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.quadraticCurveTo(width/2, height/2 + 100, p2.x, p2.y);
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 4;
            ctx.stroke();

            entities.forEach(e => e.draw());
            p1.draw();
            p2.draw();

            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
            });
        }

        function loop() {
            if(gameActive) {
                update();
                draw();
                animationFrameId = requestAnimationFrame(loop);
            }
        }

        function startGame() {
            document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
            init();
            gameActive = true;
            loop();
        }

        function gameOver(reason) {
            gameActive = false;
            document.getElementById('loseScreen').classList.remove('hidden');
            document.getElementById('deathReason').innerText = reason;
        }

        function winGame() {
            gameActive = false;
            document.getElementById('winScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = "× ×™×§×•×“: " + score;
            // ×¦×™×•×¨ × ×©×™×§×”
            ctx.clearRect(0,0,width,height);
            ctx.font = "100px Arial";
            ctx.textAlign = "center";
            ctx.fillText("ğŸ’‹", width/2, height/2);
        }

    </script>
</body>
</html>
