<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Together to the Top - Survival Mode</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #2c3e50;
            font-family: 'Segoe UI', sans-serif;
            touch-action: none;
            user-select: none;
        }

        /* ×××©×§ ××©×ª××© */
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 5;
        }

        .hud-top {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            font-weight: bold;
        }

        /* ×‘×¨ ×‘×¨×™××•×ª */
        .health-container {
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border: 2px solid white;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .health-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff4b1f, #ff9068);
            transition: width 0.2s;
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            color: white;
            width: 100%;
            text-align: center;
        }

        /* ×‘×¨ ×”×ª×§×“××•×ª */
        .progress-wrapper {
            position: absolute;
            bottom: 20px;
            left: 10%;
            width: 80%;
        }
        
        .progress-bg {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: #00b09b;
            border-radius: 4px;
            transition: width 0.1s;
        }

        /* ××¡×›×™× (×¤×ª×™×—×”/×¡×™×•×/×”×¤×¡×“) */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            pointer-events: auto;
            backdrop-filter: blur(8px);
            text-align: center;
        }
        
        button {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            border: none;
            padding: 15px 50px;
            color: white;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-top: 25px;
            font-weight: bold;
            font-family: inherit;
        }

        .lose-btn {
            background: linear-gradient(45deg, #cb2d3e, #ef473a);
        }
        
        button:active { transform: scale(0.95); }
        .hidden { display: none !important; }

        /* ××–×•×¨×™ ××’×¢ */
        .touch-zone {
            position: absolute;
            top: 0;
            height: 100%;
            width: 50%;
        }
        #leftZone { left: 0; }
        #rightZone { right: 0; }

        .danger-text {
            color: #ff4b4b;
            font-size: 18px;
            margin-top: 10px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }

    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui">
        <div class="hud-top">
            <div class="health-container">
                <div class="health-bar" id="healthBar"></div>
                <div class="health-text">×× ×¨×’×™×” ×–×•×’×™×ª</div>
            </div>
            <div style="font-size: 20px;">ğŸ›¡ï¸ <span id="shieldCount">0</span></div>
            <div style="font-size: 20px;">â¤ï¸ <span id="score">0</span></div>
        </div>

        <div class="progress-wrapper">
            <div style="text-align: center; color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 5px;">×”××¨×—×§ ×œ×¤×¡×’×”</div>
            <div class="progress-bg">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div id="leftZone" class="touch-zone"></div>
        <div id="rightZone" class="touch-zone"></div>
    </div>

    <div id="startScreen" class="overlay">
        <h1>×”×˜×™×¤×•×¡ ×œ×¤×¡×’×”</h1>
        <p>×©×¨×“×• ××ª ×”×¡×œ×¢×™×, ××¡×¤×• ×œ×‘×‘×•×ª ×•×”×’×™×¢×• ×œ××¢×œ×” ×‘×™×—×“!</p>
        <p class="danger-text">âš ï¸ ×–×”×™×¨×•×ª: × ×¤×™×œ×” ×œ××˜×” ××• ×¡×™×•× ×”×× ×¨×’×™×” = ×¤×¡×™×œ×”!</p>
        <button onclick="startGame()">×”×ª×—×œ ××¡×¢</button>
    </div>

    <div id="loseScreen" class="overlay hidden">
        <h1 style="color: #ff6b6b; font-size: 50px;">× ×¤×¡×œ×ª×! ğŸ’”</h1>
        <p id="deathReason" style="font-size: 20px; margin-top: 10px;">× ×’××¨×” ×”×× ×¨×’×™×”...</p>
        <p>× ×¡×• ×œ×©××•×¨ ××—×“ ×¢×œ ×”×©× ×™!</p>
        <button class="lose-btn" onclick="startGame()">× ×¡×• ×©×•×‘</button>
    </div>

    <div id="winScreen" class="overlay hidden">
        <h1 style="color: #4cd137; font-size: 50px;">× ×™×¦×—×•×Ÿ! ğŸ’</h1>
        <p>×”×•×›×—×ª× ×©××”×‘×” ×× ×¦×—×ª ×”×›×œ!</p>
        <p id="finalScore" style="font-size: 24px; font-weight: bold;"></p>
        <button onclick="startGame()">×¡×™×‘×•×‘ × ×•×¡×£</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ×ª××•× ×•×ª
        const imgP1 = new Image(); imgP1.src = "Screenshot_14.png"; 
        const imgP2 = new Image(); imgP2.src = "Screenshot_15.png";

        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let width, height;
        let animationId;
        let gameRunning = false;
        let frames = 0;
        
        // ×”×’×“×¨×•×ª ×§×•×©×™ ×•××©×—×§×™×•×ª
        const GOAL_DISTANCE = 3000;
        let distanceTraveled = 0;
        let score = 0;
        let health = 100;
        let difficulty = 1.0;
        
        // × ×™×”×•×œ ××•×‘×™×™×§×˜×™×
        let p1, p2;
        let entities = [];
        let particles = [];
        let keys = {};
        let touchTarget = { left: null, right: null };

        // --- ××—×œ×§×•×ª ---

        class Player {
            constructor(x, y, color, img, controls) {
                this.x = x;
                this.y = y;
                this.radius = 30;
                this.color = color;
                this.img = img;
                this.controls = controls;
                this.vx = 0;
                this.vy = 0;
                this.hasShield = false;
            }

            update() {
                // ×ª× ×•×¢×”
                if (keys[this.controls.right]) this.vx += 1.2;
                if (keys[this.controls.left]) this.vx -= 1.2;

                // ××’×¢
                let target = (this.controls.left === 'KeyA') ? touchTarget.left : touchTarget.right;
                if (target !== null) {
                    this.vx += (target - this.x) * 0.08;
                }

                // ×¤×™×–×™×§×”
                this.vx *= 0.9; // ×—×™×›×•×š
                this.x += this.vx;

                // ×’×‘×•×œ×•×ª ×§×™×¨×•×ª
                if (this.x < this.radius) { this.x = this.radius; this.vx *= -0.5; }
                if (this.x > width - this.radius) { this.x = width - this.radius; this.vx *= -0.5; }

                // ×’×‘×•×œ×•×ª ×× ×›×™×™× (×”××¡×š ×–×– ×œ××¢×œ×”, ××– ×”×©×—×§×Ÿ × ×“×—×£ ×œ××˜×” ××œ× ×× ×”×•× ×–×–)
                // "×›×‘×™×“×ª ××©×—×§" - ×”×©×—×§×Ÿ × ××©×š ×œ××˜ ×œ××˜×”
                if (this.y < height - 100) {
                    this.y += 1.5;
                }

                // ×‘×“×™×§×ª ××•×•×ª (× ×¤×™×œ×” ××”××¡×š)
                if (this.y > height + this.radius) {
                    gameOver("××—×“ ××›× × ×¤×œ ×œ×ª×”×•×!");
                }
            }

            draw() {
                // ××’×Ÿ
                if (this.hasShield) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius + 8, 0, Math.PI*2);
                    ctx.strokeStyle = '#00f260';
                    ctx.lineWidth = 3;
                    ctx.setLineDash([5, 5]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                ctx.save();
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.clip();
                try {
                    ctx.drawImage(this.img, this.x - this.radius, this.y - this.radius, this.radius*2, this.radius*2);
                } catch(e) {
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                ctx.restore();
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        class Entity {
            constructor() {
                this.type = Math.random() < 0.8 ? 'rock' : (Math.random() < 0.5 ? 'heart' : 'shield');
                this.x = Math.random() * (width - 40) + 20;
                this.y = -60;
                this.size = (this.type === 'rock') ? 25 + Math.random() * 30 : 25;
                // ××”×™×¨×•×ª ×ª×œ×•×™×” ×‘×§×•×©×™
                this.speed = (3 + Math.random() * 4) * difficulty; 
                this.active = true;
                this.rotation = Math.random() * Math.PI;
            }

            update() {
                this.y += this.speed;
                this.rotation += 0.05;
                if (this.y > height + 50) this.active = false;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                if (this.type === 'rock') {
                    ctx.fillStyle = '#636e72';
                    ctx.beginPath();
                    ctx.moveTo(-this.size, -this.size/2);
                    ctx.lineTo(this.size, -this.size);
                    ctx.lineTo(this.size/2, this.size);
                    ctx.lineTo(-this.size/2, this.size/2);
                    ctx.fill();
                    // ×”×¦×œ×œ×” ×œ×¡×œ×¢
                    ctx.fillStyle = 'rgba(0,0,0,0.2)';
                    ctx.fill();
                } else if (this.type === 'heart') {
                    ctx.font = "30px Arial";
                    ctx.fillText("â¤ï¸", -15, 10);
                } else if (this.type === 'shield') {
                    ctx.font = "30px Arial";
                    ctx.fillText("ğŸ›¡ï¸", -15, 10);
                }
                ctx.restore();
            }
        }

        // --- ×¤×•× ×§×¦×™×•×ª ××¢×¨×›×ª ---

        function init() {
            resize();
            p1 = new Player(width*0.25, height-150, 'red', imgP1, {left: 'KeyA', right: 'KeyD'});
            p2 = new Player(width*0.75, height-150, 'blue', imgP2, {left: 'ArrowLeft', right: 'ArrowRight'});
            entities = [];
            particles = [];
            
            // ××™×¤×•×¡ ××©×ª× ×™×
            distanceTraveled = 0;
            score = 0;
            health = 100;
            difficulty = 1.0;
            frames = 0;

            document.getElementById('healthBar').style.width = '100%';
            document.getElementById('healthBar').style.background = 'linear-gradient(90deg, #ff4b1f, #ff9068)';
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);

        // ×©×œ×™×˜×”
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);
        
        ['touchstart', 'touchmove'].forEach(evt => {
            document.getElementById('leftZone').addEventListener(evt, (e) => { e.preventDefault(); touchTarget.left = e.touches[0].clientX; });
            document.getElementById('rightZone').addEventListener(evt, (e) => { e.preventDefault(); touchTarget.right = e.touches[0].clientX; });
        });
        ['touchend'].forEach(evt => {
            document.getElementById('leftZone').addEventListener(evt, () => touchTarget.left = null);
            document.getElementById('rightZone').addEventListener(evt, () => touchTarget.right = null);
        });

        // --- ×œ×•×œ××ª ××©×—×§ ---

        function update() {
            if (!gameRunning) return;
            frames++;

            // 1. ×¢×“×›×•×Ÿ ×§×•×©×™ (×œ××˜ ×œ××˜)
            distanceTraveled += 2 * difficulty; // ××ª×§×“××™× ××”×¨ ×™×•×ª×¨ ×‘×“×¨×’×•×ª ×’×‘×•×”×•×ª
            difficulty = 1 + (distanceTraveled / 5000); // ×”×§×•×©×™ ×¢×•×œ×” ×›×›×œ ×©××ª×§×“××™×

            // ×¢×“×›×•×Ÿ UI
            document.getElementById('score').innerText = score;
            const shieldCount = (p1.hasShield?1:0) + (p2.hasShield?1:0);
            document.getElementById('shieldCount').innerText = shieldCount;
            document.getElementById('progressFill').style.width = Math.min(100, (distanceTraveled/GOAL_DISTANCE)*100) + '%';

            // ×‘×“×™×§×ª × ×™×¦×—×•×Ÿ
            if (distanceTraveled >= GOAL_DISTANCE) {
                winGame();
                return;
            }

            // 2. ×™×¦×™×¨×ª ××›×©×•×œ×™× (×§×¦×‘ ×¢×•×œ×” ×¢× ×”×§×•×©×™)
            // ×›×›×œ ×©×”×§×•×©×™ ×¢×•×œ×” (difficulty > 1), ×”××¡×¤×¨ ×”×–×” ×™×•×¨×“ -> × ×•×¦×¨×™× ×™×•×ª×¨ ×¡×œ×¢×™×
            let spawnRate = Math.max(15, Math.floor(50 / difficulty)); 
            
            if (frames % spawnRate === 0) {
                entities.push(new Entity());
            }

            p1.update();
            p2.update();

            // ×¢×“×›×•×Ÿ ×—×•×˜ ××§×©×¨ (××©×™×›×”)
            const dx = p1.x - p2.x;
            const dy = p1.y - p2.y;
            if (Math.hypot(dx, dy) > width * 0.6) {
                p1.vx -= dx * 0.01;
                p2.vx += dx * 0.01;
            }

            // ×¢×“×›×•×Ÿ ×™×©×•×™×•×ª
            entities = entities.filter(e => e.active);
            entities.forEach(e => {
                e.update();
                
                // ×”×ª× ×’×©×•×™×•×ª
                [p1, p2].forEach(p => {
                    let dist = Math.hypot(p.x - e.x, p.y - e.y);
                    if (dist < p.radius + e.size/2) {
                        if (e.type === 'rock') {
                            if (p.hasShield) {
                                p.hasShield = false;
                                createExplosion(e.x, e.y, '#00f260');
                                e.active = false;
                            } else {
                                // ×¤×’×™×¢×”!
                                health -= 20;
                                updateHealthBar();
                                createExplosion(p.x, p.y, '#ff4b1f');
                                
                                // ×¢×•× ×© ×¤×™×–×™×§×œ×™ ×—×–×§ ×™×•×ª×¨
                                p.y += 120; 
                                p.vx = (Math.random()-0.5) * 30; // ××™×‘×•×“ ×©×™×•×•×™ ××©×§×œ
                                
                                e.active = false;

                                if (health <= 0) {
                                    gameOver("× ×’××¨×” ×œ×›× ×”×× ×¨×’×™×”!");
                                }
                            }
                        } else if (e.type === 'heart') {
                            score += 50;
                            health = Math.min(100, health + 10); // ×¨×™×¤×•×™
                            updateHealthBar();
                            e.active = false;
                        } else if (e.type === 'shield') {
                            p.hasShield = true;
                            e.active = false;
                        }
                    }
                });
            });

            // ×—×œ×§×™×§×™×
            particles.forEach((part, i) => {
                part.x += part.vx;
                part.y += part.vy;
                part.life--;
                if(part.life <= 0) particles.splice(i, 1);
            });
        }

        function updateHealthBar() {
            const bar = document.getElementById('healthBar');
            bar.style.width = Math.max(0, health) + '%';
            if (health < 30) bar.style.background = '#ff0000'; // ×¦×‘×¢ ××“×•× ×›×©×¨×§ ×§×¦×ª ×—×™×™×
            else bar.style.background = 'linear-gradient(90deg, #ff4b1f, #ff9068)';
        }

        function createExplosion(x, y, color) {
            for(let i=0; i<15; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
                    color: color, life: 20
                });
            }
        }

        function draw() {
            // ×¨×§×¢ ×“×™× ××™ (××©×ª× ×” ×œ×¤×™ ×’×•×‘×”)
            let ratio = Math.min(1, distanceTraveled / GOAL_DISTANCE);
            // ×-×›×—×•×œ ×›×”×” ×œ-×›×ª×•× ×©×œ ×©×§×™×¢×” ×‘×¤×¡×’×”
            let r = Math.floor(44 + (255-44)*ratio);
            let g = Math.floor(62 + (100-62)*ratio);
            let b = Math.floor(80 + (80-80)*ratio);
            ctx.fillStyle = `rgb(${r},${g},${b})`;
            ctx.fillRect(0, 0, width, height);

            // ×ª×”×•× ×œ××˜×”
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, height - 20, width, 20);

            // ×—×•×˜
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.quadraticCurveTo((p1.x+p2.x)/2, (p1.y+p2.y)/2 + 50, p2.x, p2.y);
            ctx.strokeStyle = 'rgba(255,255,255,0.4)';
            ctx.lineWidth = 3;
            ctx.stroke();

            entities.forEach(e => e.draw());
            p1.draw();
            p2.draw();
            particles.forEach(p => { ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 4, 4); });
        }

        function loop() {
            if (gameRunning) {
                update();
                draw();
                requestAnimationFrame(loop);
            }
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('loseScreen').classList.add('hidden');
            document.getElementById('winScreen').classList.add('hidden');
            init();
            gameRunning = true;
            loop();
        }

        function gameOver(reason) {
            gameRunning = false;
            document.getElementById('loseScreen').classList.remove('hidden');
            document.getElementById('deathReason').innerText = reason;
        }

        function winGame() {
            gameRunning = false;
            document.getElementById('winScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = "× ×™×§×•×“ ×¡×•×¤×™: " + score;
        }

        resize();
    </script>
</body>
</html>
